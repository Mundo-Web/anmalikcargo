var ct=Object.defineProperty;var it=(i,s,l)=>s in i?ct(i,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[s]=l;var p=(i,s,l)=>(it(i,typeof s!="symbol"?s+"":s,l),l);import{j as e}from"./AboutHeader-CpM0iYLI.js";import{r as x}from"./index-B80Lgev0.js";import{c as lt}from"./ReactAppend-CBRQCQGz.js";import{B as mt}from"./Base-GjfH56pO.js";import{C as ot,G as Q}from"./CreateReactScript-BuUiikl4.js";import{T as at}from"./Table-COKXynOQ.js";import{D as U}from"./DxButton-CsjWvhyj.js";import{R as X}from"./ReactAppend-C-tNgxIf.js";import{S as ht}from"./sweetalert2.all-Dh0rZL5X.js";import{B as et}from"./Results-DSrVaQ7j.js";import{N as m}from"./Number2Currency-e57Tgsuk.js";import{M as xt}from"./Modal-DUfP1iw0.js";import{i as L}from"./tippy-react.esm-CHhA99mn.js";import{m as tt}from"./main-B2CtU6ez.js";import{r as ut}from"./DxBox-CdMuSyGE.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-CPQZ59pt.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-CjZ0YwJN.js";/* empty css               */class pt extends et{constructor(){super(...arguments);p(this,"path","admin/sales")}}class jt extends et{constructor(){super(...arguments);p(this,"path","admin/sale-statuses");p(this,"bySale",async l=>{try{const{status:t,result:a}=await tt.Fetch(`/api/${this.path}/by-sale/${l}`);if(!t)throw new Error((a==null?void 0:a.message)||"Ocurrio un error inesperado");return a.data}catch(t){return tt.Notify.add({icon:"/assets/img/favicon.png",title:"Error",body:t.message,type:"danger"}),null}})}}const j=new pt,bt=new jt,dt=({statuses:i})=>{var y,v,g,w,S,_,C,k,T,R,E,F,D,B,A,O,P,z,W,Y,G,M,q,V,H,I,Z,J,K;const s=x.useRef(),l=x.useRef(),[t,a]=x.useState(null),[b,d]=x.useState([]),rt=async r=>{const n=await j.save({id:t.id,status_id:r.target.value});n&&(a(n.data),$(s.current).dxDataGrid("instance").refresh())},nt=async r=>{const{isConfirmed:n}=await ht.fire({title:"Anular pedido",text:"¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!n||!await j.delete(r)||$(s.current).dxDataGrid("instance").refresh()},N=async r=>{d([]);const n=await j.get(r);a(n),$(l.current).modal("show")};x.useEffect(()=>{t&&bt.bySale(t.id).then(r=>{d(r||[])})},[t]);const st=Number(t==null?void 0:t.amount)+Number(t==null?void 0:t.delivery)-Number(t==null?void 0:t.bundle_discount)-Number(t==null?void 0:t.renewal_discount)-Number(t==null?void 0:t.coupon_discount);return e.jsxs(e.Fragment,{children:[e.jsx(at,{gridRef:s,title:"Pedidos",rest:j,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}})},pageSize:25,columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Numero de orden",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(r,{data:n})=>{r.css("cursor","pointer"),r.on("click",()=>{N(n.id)}),X(r,e.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[e.jsxs("b",{className:"d-block",children:[n.renewal&&e.jsx(L,{content:`Plan: ${n.renewal.name}`,children:e.jsx("i",{className:"fa fas fa-spa text-pink me-1"})}),n.name," ",n.lastname]}),e.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",Q.APP_CORRELATIVE,"-",n.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(r,{data:n})=>{r.html(ut(e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-block",children:moment(n.created_at.replace("Z","-05:00")).fromNow()}),e.jsx("small",{className:"d-block text-muted",children:moment(n.created_at).format("lll")})]})))}},{dataField:"status.name",caption:"Estado",cellTemplate:(r,{data:n})=>{X(r,e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:n.status.color?`${n.status.color}2e`:"#3333332e",color:n.status.color??"#333"},children:n.status.name}),e.jsx("small",{className:"d-block text-muted",children:n.status.description})]}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(r,{data:n})=>{const c=Number(n.amount)||0,o=Number(n.delivery)||0,h=Number(n.bundle_discount)||0,u=Number(n.renewal_discount)||0,f=Number(n.coupon_discount)||0;r.text(`S/. ${m(c+o-h-u-f)}`)}},{caption:"Acciones",cellTemplate:(r,{data:n})=>{r.append(U({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>N(n.id)})),r.append(U({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>nt(n.id)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsx(xt,{modalRef:l,title:`Detalles del pedido #${Q.APP_CORRELATIVE}-${t==null?void 0:t.code}`,size:"lg",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsx("table",{id:"table-info",className:"table table-borderless table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Nombres:"}),e.jsxs("td",{children:[t==null?void 0:t.name," ",t==null?void 0:t.lastname]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Email:"}),e.jsx("td",{children:t==null?void 0:t.email})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Teléfono:"}),e.jsx("td",{children:t==null?void 0:t.phone})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Dirección:"}),e.jsxs("td",{children:[t==null?void 0:t.address," ",t==null?void 0:t.number,e.jsxs("small",{className:"text-muted d-block",children:[(t==null?void 0:t.province)??(t==null?void 0:t.district),", ",t==null?void 0:t.department,", ",t==null?void 0:t.country," ",(t==null?void 0:t.zip_code)&&e.jsxs(e.Fragment,{children:["- ",t==null?void 0:t.zip_code]})]})]})]}),(t==null?void 0:t.reference)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Referencia:"}),e.jsx("td",{children:t==null?void 0:t.reference})]}),(t==null?void 0:t.comment)&&e.jsxs("tr",{children:[e.jsx("th",{children:"Comentario:"}),e.jsx("td",{children:t==null?void 0:t.comment})]})]})}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`Nombres: ${t==null?void 0:t.fullname}
Email: ${t==null?void 0:t.email}
Teléfono: ${t==null?void 0:t.phone}
Dirección: ${t==null?void 0:t.address} ${t==null?void 0:t.number}
_${(t==null?void 0:t.province)??(t==null?void 0:t.district)}, ${t==null?void 0:t.department}, ${t==null?void 0:t.country} ${t!=null&&t.zip_code?`- ${t==null?void 0:t.zip_code}`:""}_`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Artículos"})}),e.jsx("div",{className:"card-body p-2 table-responsive",children:e.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Colores"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Subtotal"})]})}),e.jsx("tbody",{children:(y=t==null?void 0:t.details)==null?void 0:y.map((r,n)=>{var h;const c=r.quantity*100/100,o=r.price*r.quantity;return e.jsxs("tr",{children:[e.jsx("td",{children:r.name}),e.jsx("td",{children:(h=r==null?void 0:r.colors)==null?void 0:h.map((u,f)=>e.jsx(L,{content:u.name,children:e.jsx("i",{className:"mdi mdi-circle",style:{color:u.hex,WebkitTextStroke:"1px #808080"}})},f))}),e.jsxs("td",{align:"right",children:["S/ ",m(r.price)]}),e.jsx("td",{align:"center",children:c}),e.jsxs("td",{align:"right",children:["S/ ",m(o)]})]},n)})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Subtotal:"}),e.jsxs("span",{children:["S/ ",m(t==null?void 0:t.amount)]})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Envío:"}),e.jsxs("span",{children:["S/ ",m(t==null?void 0:t.delivery)]})]}),(t==null?void 0:t.bundle)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Descuento x paquete:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:["Elegiste ",(v=t==null?void 0:t.bundle)==null?void 0:v.name," (-",((g=t==null?void 0:t.bundle)==null?void 0:g.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",m(t==null?void 0:t.bundle_discount)]})]}),(t==null?void 0:t.renewal)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Subscripción:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(w=t==null?void 0:t.renewal)==null?void 0:w.name," (-",((S=t==null?void 0:t.renewal)==null?void 0:S.percentage)*1e4/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",m(t==null?void 0:t.renewal_discount)]})]}),(t==null?void 0:t.coupon)&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("b",{children:["Cupón aplicado:",e.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(_=t==null?void 0:t.coupon)==null?void 0:_.name," (-",((C=t==null?void 0:t.coupon)==null?void 0:C.amount)*100/100,"%)"]})]}),e.jsxs("span",{children:["S/ -",m(t==null?void 0:t.coupon_discount)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("b",{children:"Total:"}),e.jsx("span",{children:e.jsxs("strong",{children:["S/ ",m(st)]})})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Formula"})}),e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{children:[e.jsx("b",{children:"🧐 Tratamiento"}),":"," ",(T=(k=t==null?void 0:t.formula)==null?void 0:k.has_treatment)==null?void 0:T.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"👀 Cuero cabelludo"}),": "," ",(E=(R=t==null?void 0:t.formula)==null?void 0:R.scalp_type)==null?void 0:E.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"✅ Tipo de cabello"}),":"," ",(D=(F=t==null?void 0:t.formula)==null?void 0:F.hair_type)==null?void 0:D.description]}),e.jsxs("div",{children:[e.jsx("b",{children:"💡 Objetivos"}),":"," ",e.jsx("ul",{className:"mb-0",children:(A=(B=t==null?void 0:t.formula)==null?void 0:B.hair_goals_list)==null?void 0:A.map(r=>e.jsx("li",{children:r.description},r.id))})]}),e.jsxs("div",{children:[e.jsx("b",{children:"🫙 Fragancia"}),":"," ",(P=(O=t==null?void 0:t.formula)==null?void 0:O.fragrance)==null?void 0:P.name]}),e.jsxs("div",{children:[e.jsx("b",{children:"🎨 Colores:"}),e.jsx("ul",{children:(z=t==null?void 0:t.details)==null?void 0:z.map((r,n)=>{var c;return e.jsxs("li",{children:[r.name,": ",(c=r==null?void 0:r.colors)==null?void 0:c.map(o=>o.name).join(", ")]},n)})})]}),e.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`*Formula ${t==null?void 0:t.name}*

🧐 Tratamiento: ${(W=t==null?void 0:t.formula.has_treatment)==null?void 0:W.description}
👀 Cuero cabelludo: ${(G=(Y=t==null?void 0:t.formula)==null?void 0:Y.scalp_type)==null?void 0:G.description}
✅ Tipo de cabello: ${(q=(M=t==null?void 0:t.formula)==null?void 0:M.hair_type)==null?void 0:q.description}
💡 Objetivos:
${(H=(V=t==null?void 0:t.formula)==null?void 0:V.hair_goals_list)==null?void 0:H.map(r=>`- ${r.description}`).join(`
`)}
🫙 Fragancia: ${(Z=(I=t==null?void 0:t.formula)==null?void 0:I.fragrance)==null?void 0:Z.name}
🎨 Colores:
${(J=t==null?void 0:t.details)==null?void 0:J.map(r=>{var n;return`- ${r.name}: ${(n=r==null?void 0:r.colors)==null?void 0:n.map(c=>c.name).join(", ")}`}).join(`
`)}`,children:[e.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"",children:[e.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),e.jsx("select",{className:"form-select",id:"statusSelect",value:t==null?void 0:t.status_id,onChange:rt,disabled:!((K=t==null?void 0:t.status)!=null&&K.reversible),children:i.map((r,n)=>e.jsx("option",{value:r.id,children:r.name},n))})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header p-2",children:e.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),e.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:b==null?void 0:b.map((r,n)=>{var c,o,h;return e.jsxs("article",{class:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:r.status.color?`${r.status.color}2e`:"#3333332e"},children:[e.jsx("i",{className:"mdi mdi-circle left-2",style:{color:r.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),e.jsx("b",{style:{color:r.status.color||"#333"},children:(c=r==null?void 0:r.status)==null?void 0:c.name}),e.jsxs("small",{className:"d-block text-truncate",children:[(o=r==null?void 0:r.user)==null?void 0:o.name," ",(h=r==null?void 0:r.user)==null?void 0:h.lastname]}),e.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("YYYY-MM-DD HH:mm")})]},n)})})]})]})]})})]})};ot((i,s)=>{lt(i).render(e.jsx(mt,{...s,title:"Pedidos",children:e.jsx(dt,{...s})}))});
