import{j as t}from"./AboutHeader-CpM0iYLI.js";import{B as J}from"./Base-GjfH56pO.js";import{S as v}from"./SwitchFormGroup-Cv62QkRk.js";import{r as l}from"./index-B80Lgev0.js";import{c as W}from"./ReactAppend-CBRQCQGz.js";import{r as T}from"./DxBox-CdMuSyGE.js";import{S as K}from"./sweetalert2.all-Dh0rZL5X.js";import{I as X}from"./ItemsRest-BzS876Ke.js";import{M as Y}from"./Modal-Dbgjpj-3.js";import"./main-B2CtU6ez.js";import{I as Z}from"./ImageFormGroup-CUCbODBj.js";import{I as j}from"./InputFormGroup-CFHZRLOG.js";import{Q as ee}from"./QuillFormGroup-D7flic0d.js";import{S as te}from"./SelectFormGroup-iHLz_kPb.js";import{D as P}from"./DxButton-CsjWvhyj.js";import{C as re}from"./CreateReactScript-BuUiikl4.js";import{N as M}from"./Number2Currency-e57Tgsuk.js";import{R as x}from"./ReactAppend-C-tNgxIf.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-CPQZ59pt.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-CjZ0YwJN.js";import"./Results-DSrVaQ7j.js";/* empty css               */const ie=({gridRef:n,rest:p,columns:d,toolBar:b,masterDetail:o,filterValue:f,onRefresh:g=()=>{}})=>(l.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(n.current).dxDataGrid({language:"es",dataSource:{load:async c=>{const m=await p.paginate({...c});return g(m),m}},onToolbarPreparing:c=>{const{items:m}=c.toolbarOptions;b(m)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:f,rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:10},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:d,masterDetail:o,onContentReady:(...c)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),t.jsx("div",{ref:n})),se=({title:n,gridRef:p,rest:d,columns:b,toolBar:o,masterDetail:f,filterValue:g=[],onRefresh:c})=>t.jsx("div",{className:"row",children:t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"card",children:[typeof n=="object"?t.jsx("div",{className:"card-header",children:n}):"",t.jsxs("div",{className:"card-body",children:[typeof n!="object"?t.jsxs("h4",{className:"header-title",children:[t.jsx("div",{id:"header-title-options",className:"float-end"}),t.jsx("span",{id:"header-title-prefix"})," Lista de ",n," ",t.jsx("span",{id:"header-title-suffix"})]}):"",t.jsx(ie,{gridRef:p,rest:d,columns:b.filter(Boolean),toolBar:o,masterDetail:f,filterValue:g,onRefresh:c})]})]})})}),y=new X,le=({categories:n,brands:p})=>{const[d,b]=l.useState([]),o=l.useRef(),f=l.useRef(),g=l.useRef(),c=l.useRef(),m=l.useRef(),D=l.useRef(),F=l.useRef(),I=l.useRef(),w=l.useRef(),S=l.useRef(),k=l.useRef(),[O,E]=l.useState(!1),[ne,_]=l.useState(null),[R,u]=l.useState([]),G=l.useRef(),z=e=>{const i=Array.from(e.target.files).map(s=>({file:s,url:URL.createObjectURL(s)}));u(s=>[...s,...i])},L=e=>{e.preventDefault();const i=Array.from(e.dataTransfer.files).map(s=>({file:s,url:URL.createObjectURL(s)}));u(s=>[...s,...i])},q=e=>{e.preventDefault()},U=(e,r)=>{e.preventDefault(),R[r].id?u(s=>s.map((h,C)=>C===r?{...h,toDelete:!0}:h)):u(s=>s.filter((h,C)=>C!==r))};l.useEffect(()=>{if(d&&d.images){const e=d.images.map(r=>({id:r.id,url:`/api/items/media/${r.url}`}));u(e)}},[d]);const B=e=>{if(b(e||null),e!=null&&e.id?E(!0):E(!1),g.current.value=(e==null?void 0:e.id)||"",$(c.current).val((e==null?void 0:e.category_id)||null).trigger("change"),m.current.value=(e==null?void 0:e.name)||"",D.current.value=(e==null?void 0:e.summary)||"",F.current.value=(e==null?void 0:e.price)||0,I.current.value=(e==null?void 0:e.discount)||0,w.current.value=null,w.image.src=`/api/items/media/${(e==null?void 0:e.image)??"undefined"}`,S.editor.root.innerHTML=(e==null?void 0:e.description)??"",e!=null&&e.images){const r=e.images.map(i=>({id:i.id,url:`/api/items/media/${i.url}`}));u(r)}else u([]);k.current.value=e==null?void 0:e.stock,$(f.current).modal("show")},Q=async e=>{e.preventDefault();const r={id:g.current.value||void 0,category_id:c.current.value,name:m.current.value,summary:D.current.value,price:F.current.value,discount:I.current.value,description:S.current.value,sotck:k.current.value},i=new FormData;for(const a in r)i.append(a,r[a]);const s=w.current.files[0];s&&i.append("image",s),R.forEach((a,A)=>{a.toDelete||(a.file?i.append(`gallery[${A}]`,a.file):i.append(`gallery_ids[${A}]`,a.id))});const h=R.filter(a=>a.toDelete).map(a=>parseInt(a.id,10));h.length>0&&i.append("deleted_images",JSON.stringify(h)),await y.save(i)&&($(o.current).dxDataGrid("instance").refresh(),$(f.current).modal("hide"),u([]))},V=async({id:e,value:r})=>{await y.boolean({id:e,field:"visible",value:r})&&$(o.current).dxDataGrid("instance").refresh()},N=async({id:e,field:r,value:i})=>{await y.boolean({id:e,field:r,value:i})&&$(o.current).dxDataGrid("instance").refresh()},H=async e=>{const{isConfirmed:r}=await K.fire({title:"Eliminar Item",text:"¿Estás seguro de eliminar este item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await y.delete(e)||$(o.current).dxDataGrid("instance").refresh()};return t.jsxs(t.Fragment,{children:[t.jsx(se,{gridRef:o,title:"Items",rest:y,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(o.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>B()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:r})=>{var i,s;e.html(T(t.jsxs(t.Fragment,{children:[t.jsx("b",{className:"d-block",children:(i=r.category)==null?void 0:i.name}),t.jsx("small",{className:"text-muted",children:(s=r.subcategory)==null?void 0:s.name})]})))}},{dataField:"subcategory.name",caption:"Subcategoría",visible:!1},{dataField:"brand.name",caption:"Marca",width:"120px"},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:r})=>{e.html(T(t.jsxs(t.Fragment,{children:[t.jsx("b",{children:r.name}),t.jsx("br",{}),t.jsx("span",{className:"truncate",children:r.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:r})=>{e.html(T(t.jsxs(t.Fragment,{children:[r.discount>0&&t.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",M(r.price)]}),t.jsxs("span",{children:["S/.",M(r.discount>0?r.discount:r.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:r})=>{x(e,t.jsx("img",{src:`/api/items/media/${r.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:i=>i.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{x(e,t.jsx(v,{checked:r.is_new,onChange:i=>N({id:r.id,field:"is_new",value:i.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{x(e,t.jsx(v,{checked:r.offering,onChange:i=>N({id:r.id,field:"offering",value:i.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{x(e,t.jsx(v,{checked:r.recommended,onChange:i=>N({id:r.id,field:"recommended",value:i.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{x(e,t.jsx(v,{checked:r.featured,onChange:i=>N({id:r.id,field:"featured",value:i.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:r})=>{x(e,t.jsx(v,{checked:r.visible,onChange:i=>V({id:r.id,value:i.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.css("text-overflow","unset"),e.append(P({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>B(r)})),e.append(P({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>H(r.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsxs(Y,{modalRef:f,title:O?"Editar Item":"Agregar Item",onSubmit:Q,size:"xl",children:[t.jsxs("div",{className:"row",id:"principal-container",children:[t.jsx("input",{ref:g,type:"hidden"}),t.jsxs("div",{className:"col-md-6",children:[t.jsx(j,{eRef:m,label:"Nombre",required:!0}),t.jsx(j,{eRef:D,label:"Resumen"}),t.jsx(te,{eRef:c,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>_(e.target.value),children:n.map((e,r)=>t.jsx("option",{value:e.id,children:e.name},r))}),t.jsx(j,{label:"Stock",eRef:k,type:"number"}),t.jsx(j,{eRef:F,label:"Precio",type:"number",step:"0.01",required:!0}),t.jsx(j,{eRef:I,label:"Descuento",type:"number",step:"0.01"})]}),t.jsx("div",{className:"col-md-6",children:t.jsxs("div",{className:"row",children:[t.jsx(Z,{eRef:w,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),t.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[t.jsx("label",{className:"form-label",children:"Galeria"}),t.jsx("input",{id:"input-item-gallery",ref:G,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:z}),t.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"254px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>G.current.click(),onDrop:L,onDragOver:q,children:t.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),t.jsx("div",{className:"col-md-12 col-sm-12",children:t.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:R.map((e,r)=>t.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[t.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),t.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:i=>U(i,r),children:"×"})]},r))})})]})})]}),t.jsx("hr",{className:"my-1"}),t.jsx(ee,{eRef:S,label:"Descripcion"})]})]})};re((n,p)=>{W(n).render(t.jsx(J,{...p,title:"Items",children:t.jsx(le,{...p})}))});
