var p=Object.defineProperty;var y=(a,t,e)=>t in a?p(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var u=(a,t,e)=>(y(a,typeof t!="symbol"?t+"":t,e),e);import{j as g}from"./AboutHeader-CpM0iYLI.js";import{r as l}from"./index-B80Lgev0.js";import{m as h}from"./main-B2CtU6ez.js";import{B as C}from"./Results-DSrVaQ7j.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class S extends C{constructor(){super(...arguments);u(this,"path","items");u(this,"verifyStock",async e=>{try{const{status:c,result:s}=await h.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(e)});if(!c)throw new Error((s==null?void 0:s.message)??"OcurriÃ³ un error al consultar el stock de los productos");return s.data??[]}catch{return[]}})}}const x=l.createContext(),E=new S,R=({children:a})=>{const[t,e]=l.useState(()=>{const r=localStorage.getItem("carrito");return r?JSON.parse(r):[]});console.log("data",t);const c=async()=>{try{if(t.length===0)return;E.verifyStock(t.map(r=>r.id)).then(r=>{const i=t.map(n=>{const o=r.find(f=>f.id===n.id);return o?{...n,price:o.price,final_price:o.final_price,discount:o.discount,name:o.name}:n});e(i)})}catch(r){console.error("Error al actualizar precios:",r)}};l.useEffect(()=>{c(),console.log("estoy actualizando")},[]),l.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(t))},[t]);const s=r=>{e(i=>i.find(o=>o.id===r.id)?i.map(o=>o.id===r.id?{...o,quantity:o.quantity+1,color:null,size:null}:o):[...i,{...r,quantity:1,color:null,size:null}])},m=r=>{e(i=>i.filter(n=>n.id!==r))},d=()=>{e([])};return g.jsx(x.Provider,{value:{carrito:t,agregarAlCarrito:s,eliminarProducto:m,vaciarCarrito:d,actualizarPrecios:c},children:a})};export{x as C,R as a};
