var w=Object.defineProperty;var S=(o,e,r)=>e in o?w(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r;var m=(o,e,r)=>(S(o,typeof e!="symbol"?e+"":e,r),r);import{j as z}from"./AboutHeader-CpM0iYLI.js";import{r as y}from"./index-B80Lgev0.js";import{m as x}from"./main-B2CtU6ez.js";import{B as v}from"./Results-Bfh1pGtp.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class I extends v{constructor(){super(...arguments);m(this,"path","items");m(this,"verifyStock",async r=>{try{const{status:s,result:l}=await x.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(r)});if(!s)throw new Error((l==null?void 0:l.message)??"Ocurrió un error al consultar el stock de los productos");return l.data??[]}catch{return[]}});m(this,"getDestacados",async()=>{try{const{status:r,result:s}=await x.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!r)throw new Error((s==null?void 0:s.message)??"Ocurrió un error al consultar el stock de los productos");return s.data??[]}catch{return[]}})}}const O=y.createContext(),k=new I,V=({children:o})=>{const[e,r]=y.useState(()=>{const t=localStorage.getItem("carrito");return t?JSON.parse(t):[]});console.log("data",e);const s=async()=>{try{if(e.length===0)return;k.verifyStock(e.map(t=>t.id)).then(t=>{const n=e.map(u=>{const i=t.find(d=>d.id===u.id);return i?{...u,price:i.price,final_price:i.final_price,discount:i.discount,name:i.name}:u});r(n)})}catch(t){console.error("Error al actualizar precios:",t)}};y.useEffect(()=>{s(),console.log("estoy actualizando")},[]),y.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(e))},[e]);const l=t=>{r(n=>{var h;if(!(t.sizes&&t.sizes.length>0||t.colors&&t.colors.length>0))return n.find(a=>a.id===t.id)?n.map(a=>a.id===t.id?{...a,quantity:a.quantity+t.quantity}:a):[...n,{...t,variations:[],quantity:t.quantity}];const i={color:t.selectedColor||null,size:t.selectedSize||null,quantity:t.quantity},d=n.findIndex(c=>c.id===t.id);if(d>=0){const c=[...n],a=c[d],g=((h=a.variations)==null?void 0:h.findIndex(f=>f.color===i.color&&f.size===i.size))??-1;return g>=0?c[d]={...a,variations:a.variations.map((f,E)=>E===g?{...f,quantity:f.quantity+i.quantity}:f)}:c[d]={...a,variations:[...a.variations,i]},c}else return[...n,{...t,variations:[i],quantity:t.quantity}]})},q=t=>{r(n=>n.filter(u=>u.id!==t))},C=()=>{r([])};return z.jsx(O.Provider,{value:{carrito:e,agregarAlCarrito:l,eliminarProducto:q,vaciarCarrito:C,actualizarPrecios:s},children:o})};export{V as C,O as a};
