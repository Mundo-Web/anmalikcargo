var U=Object.defineProperty;var V=(a,r,o)=>r in a?U(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o;var N=(a,r,o)=>(V(a,typeof r!="symbol"?r+"":r,o),o);import{j as s}from"./PersistentScrollAnimation-CpM0iYLI.js";import{r as n}from"./index-B80Lgev0.js";import{B as W}from"./Base-Ba0e7oCU.js";import{c as z}from"./ReactAppend-CBRQCQGz.js";import{r as S}from"./DxBox-CdMuSyGE.js";import{S as P}from"./sweetalert2.all-Dh0rZL5X.js";import{B as H}from"./Results-DuIoLp_E.js";import{M as K}from"./Modal-grV2YpGh.js";import{T as Q}from"./Table-D2yzuWSL.js";import{I as X}from"./ImageFormGroup-DaZbWyKO.js";import{I as D}from"./InputFormGroup-BHWAVuSa.js";import{D as F}from"./DxButton-CsjWvhyj.js";import{C as Y}from"./CreateReactScript-CyT_ENnh.js";import{R as w}from"./ReactAppend-C-tNgxIf.js";import{S as T}from"./SwitchFormGroup-C9mpjy5E.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-Cu-mVv1q.js";/* empty css               */class Z extends H{constructor(){super(...arguments);N(this,"path","admin/services");N(this,"hasFiles",!0)}}const h=new Z,ee=({brands:a})=>{const[r,o]=n.useState([]),u=n.useRef(),x=n.useRef(),g=n.useRef(),v=n.useRef(),b=n.useRef(),f=n.useRef(),j=n.useRef(),[y,d]=n.useState([]),k=n.useRef(),[m,p]=n.useState([{value:""}]),[R,E]=n.useState(!1),G=e=>{const i=Array.from(e.target.files).map(l=>({file:l,url:URL.createObjectURL(l),isNew:!0}));d(l=>[...l,...i])},I=e=>{d(t=>t.filter((i,l)=>l!==e))},B=()=>{p([...m,{value:""}])},A=(e,t)=>{const i=[...m];i[e].value=t,p(i)},M=e=>{if(m.length<=1)return;const t=m.filter((i,l)=>l!==e);p(t)},C=e=>{if(o(e||null),E(!!(e!=null&&e.id)),g.current.value=(e==null?void 0:e.id)||"",v.current.value=(e==null?void 0:e.title)||"",b.current.value=(e==null?void 0:e.description)||"",f.current.value=null,e!=null&&e.image&&(f.image.src=`/api/service/media/${e.image}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const t=e.gallery.map(i=>({url:`/api/service/media/${i}`,isNew:!1}));d(t)}else d([]);e!=null&&e.characteristics&&e.characteristics.length>0?p(e.characteristics.map(t=>({value:t}))):p([{value:""}]),j.current.value=(e==null?void 0:e.link)??"",$(x.current).modal("show")},O=async e=>{e.preventDefault();const t=new FormData;t.append("title",v.current.value),t.append("description",b.current.value),t.append("link",j.current.value),R&&t.append("id",g.current.value),f.current.files[0]&&t.append("image",f.current.files[0]),y.filter(c=>c.isNew).forEach((c,J)=>{t.append(`gallery[${J}]`,c.file)});const i=y.filter(c=>!c.isNew).map(c=>c.url.split("/").pop());t.append("existing_gallery",JSON.stringify(i));const l=m.map(c=>c.value.trim()).filter(c=>c.length>0);t.append("characteristics",JSON.stringify(l)),await h.save(t)&&($(u.current).dxDataGrid("instance").refresh(),$(x.current).modal("hide"),d([]),p([{value:""}]))},L=async e=>{const{isConfirmed:t}=await P.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await h.delete(e)||$(u.current).dxDataGrid("instance").refresh()},_=async({id:e,value:t})=>{await h.boolean({id:e,field:"visible",value:t})&&$(u.current).dxDataGrid("instance").refresh()},q=async({id:e,value:t})=>{await h.boolean({id:e,field:"featured",value:t})&&$(u.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(Q,{gridRef:u,title:"Servicios",rest:h,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(u.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>C()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:t})=>{e.html(S(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:t.description})))}},{dataField:"characteristics",caption:"Características",cellTemplate:(e,{data:t})=>{t.characteristics&&e.html(S(s.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[t.characteristics.slice(0,2).map((i,l)=>s.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:s.jsxs("small",{children:["• ",i]})},l)),t.characteristics.length>2&&s.jsx("li",{children:s.jsxs("small",{className:"text-muted",children:["+",t.characteristics.length-2," ","más..."]})})]})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:t})=>{w(e,s.jsx("img",{src:`/api/service/media/${t.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:i=>i.target.src="/images/default-thumbnail.jpg"}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),w(e,s.jsx(T,{checked:t.featured==1,onChange:()=>q({id:t.id,value:!t.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:t})=>{$(e).empty(),w(e,s.jsx(T,{checked:t.visible==1,onChange:()=>_({id:t.id,value:!t.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.append(F({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>C(t)})),e.append(F({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>L(t.id)}))}}]}),s.jsxs(K,{modalRef:x,title:R?"Editar Servicio":"Nuevo Servicio",onSubmit:O,size:"xl",children:[s.jsx("input",{ref:g,type:"hidden"}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx(D,{eRef:v,label:"Título del servicio",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{ref:b,className:"form-control",rows:4,required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),m.map((e,t)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Duración de la sesión - 45 a 60 minutos",value:e.value,onChange:i=>A(t,i.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>M(t),disabled:m.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},t)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:B,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]}),s.jsx(D,{type:"url",eRef:j,label:"Link"})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx(X,{eRef:f,label:"Imagen principal",aspect:16/9}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Galería de imágenes"}),s.jsx("input",{type:"file",ref:k,multiple:!0,accept:"image/*",onChange:G,className:"form-control"}),s.jsx("div",{className:"d-flex flex-wrap gap-2 mt-2",children:y.map((e,t)=>s.jsxs("div",{className:"position-relative",style:{width:"100px",height:"100px"},children:[s.jsx("img",{src:e.url,alt:"Preview",className:"img-thumbnail h-100 w-100 object-fit-cover"}),s.jsx("button",{type:"button",className:"btn btn-danger btn-xs position-absolute top-0 end-0",onClick:()=>I(t),children:"×"})]},t))})]})]})]})]})]})};Y((a,r)=>{z(a).render(s.jsx(W,{...r,title:"Servicios",children:s.jsx(ee,{...r})}))});
