var J=Object.defineProperty;var L=(n,t,o)=>t in n?J(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o;var N=(n,t,o)=>(L(n,typeof t!="symbol"?t+"":t,o),o);import{j as r}from"./FileViewer-CpM0iYLI.js";import{r as l}from"./index-B80Lgev0.js";import{B as W}from"./Base-Dn7f6qrh.js";import{c as _}from"./ReactAppend-CBRQCQGz.js";import{r as D}from"./DxBox-CdMuSyGE.js";import{S as z}from"./sweetalert2.all-Dh0rZL5X.js";import{B as P}from"./Results-B9dLaNz0.js";import{M as H}from"./Modal-CbHkO7Dn.js";import{T as K}from"./Table-CEq6jy84.js";import{I as F}from"./ImageFormGroup-BJIwAJGo.js";import{I as Q}from"./InputFormGroup-DZ3W53Mr.js";import{D as T}from"./DxButton-CsjWvhyj.js";import{C as U}from"./CreateReactScript-Bj11ghWz.js";import{R as h}from"./ReactAppend-C-tNgxIf.js";import{S as E}from"./SwitchFormGroup-ChGOZLEW.js";import{L as X}from"./Filter-1mRNSgu6.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BvL_iu_4.js";/* empty css               */class Y extends P{constructor(){super(...arguments);N(this,"path","admin/services");N(this,"hasFiles",!0)}}const x=new Y,Z=({brands:n})=>{const[t,o]=l.useState([]),m=l.useRef(),v=l.useRef(),b=l.useRef(),j=l.useRef(),y=l.useRef(),d=l.useRef(),p=l.useRef(),g=l.useRef(),[w,R]=l.useState([]),[a,u]=l.useState([{value:""}]),[C,I]=l.useState(!1),B=()=>{u([...a,{value:""}])},k=(e,i)=>{const s=[...a];s[e].value=i,u(s)},G=e=>{if(a.length<=1)return;const i=a.filter((s,f)=>f!==e);u(i)},S=e=>{if(o(e||null),I(!!(e!=null&&e.id)),b.current.value=(e==null?void 0:e.id)||"",j.current.value=(e==null?void 0:e.title)||"",y.current.value=(e==null?void 0:e.description)||"",d.current.value=null,p.current.value=null,g.current.value=(e==null?void 0:e.color)||"#000000",e!=null&&e.image&&(d.image.src=`/api/service/media/${e.image}`),e!=null&&e.icon&&(p.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const i=e.gallery.map(s=>({url:`/api/service/media/${s}`,isNew:!1}));R(i)}else R([]);e!=null&&e.characteristics&&e.characteristics.length>0?u(e.characteristics.map(i=>({value:i}))):u([{value:""}]),$(v.current).modal("show")},A=async e=>{e.preventDefault();const i=new FormData;i.append("title",j.current.value),i.append("description",y.current.value),i.append("color",g.current.value),C&&i.append("id",b.current.value),d.current.files[0]&&i.append("image",d.current.files[0]),p.current.files[0]&&i.append("icon",p.current.files[0]),w.filter(c=>c.isNew).forEach((c,q)=>{i.append(`gallery[${q}]`,c.file)});const s=w.filter(c=>!c.isNew).map(c=>c.url.split("/").pop());i.append("existing_gallery",JSON.stringify(s));const f=a.map(c=>c.value.trim()).filter(c=>c.length>0);i.append("characteristics",JSON.stringify(f)),await x.save(i)&&($(m.current).dxDataGrid("instance").refresh(),$(v.current).modal("hide"),R([]),u([{value:""}]),g.current.value="#000000",p.current.value=null)},M=async e=>{const{isConfirmed:i}=await z.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!i||!await x.delete(e)||$(m.current).dxDataGrid("instance").refresh()},O=async({id:e,value:i})=>{await x.boolean({id:e,field:"visible",value:i})&&$(m.current).dxDataGrid("instance").refresh()},V=async({id:e,value:i})=>{await x.boolean({id:e,field:"featured",value:i})&&$(m.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx(K,{gridRef:m,title:"Servicios",rest:x,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>S()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:i})=>{e.html(D(r.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:i.description})))}},{dataField:"characteristics",caption:"Características",cellTemplate:(e,{data:i})=>{i.characteristics&&e.html(D(r.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[i.characteristics.slice(0,2).map((s,f)=>r.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:r.jsxs("small",{children:["• ",s]})},f)),i.characteristics.length>2&&r.jsx("li",{children:r.jsxs("small",{className:"text-muted",children:["+",i.characteristics.length-2," ","más..."]})})]})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:i})=>{h(e,r.jsx("img",{src:`/api/service/media/${i.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-thumbnail.jpg"}))}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:i})=>{i.icon?h(e,r.jsx("img",{src:`/api/service/media/${i.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"color",caption:"Color",width:"80px",cellTemplate:(e,{data:i})=>{h(e,r.jsxs("div",{className:"d-flex align-items-center",children:[r.jsx("div",{style:{width:"30px",height:"20px",backgroundColor:i.color||"#000000",borderRadius:"3px",border:"1px solid #ddd",marginRight:"5px"}}),r.jsx("small",{children:i.color||"#000000"})]}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(e,{data:i})=>{$(e).empty(),h(e,r.jsx(E,{checked:i.featured==1,onChange:()=>V({id:i.id,value:!i.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:i})=>{$(e).empty(),h(e,r.jsx(E,{checked:i.visible==1,onChange:()=>O({id:i.id,value:!i.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:i})=>{e.append(T({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>S(i)})),e.append(T({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>M(i.id)}))}}]}),r.jsxs(H,{modalRef:v,title:C?"Editar Servicio":"Nuevo Servicio",onSubmit:A,size:"xl",children:[r.jsx("input",{ref:b,type:"hidden"}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-8",children:[r.jsx(Q,{eRef:j,label:"Título del servicio",required:!0}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Descripción"}),r.jsx("textarea",{ref:y,className:"form-control",rows:4,required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Color del servicio"}),r.jsx("input",{ref:g,type:"color",className:"form-control form-control-color",defaultValue:"#000000",title:"Selecciona un color"})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Características"}),a.map((e,i)=>r.jsxs("div",{className:"input-group mb-2",children:[r.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Duración de la sesión - 45 a 60 minutos",value:e.value,onChange:s=>k(i,s.target.value)}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>G(i),disabled:a.length<=1,children:r.jsx("i",{className:"fas fa-times"})})]},i)),r.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:B,children:[r.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),r.jsxs("div",{className:"col-md-4",children:[r.jsx(F,{eRef:d,label:"Imagen principal",aspect:1/1}),r.jsx(F,{eRef:p,label:"Icono del servicio",aspect:1/1})]})]})]})]})};U((n,t)=>{_(n).render(r.jsx(X,{children:r.jsx(W,{...t,title:"Servicios",children:r.jsx(Z,{...t})})}))});
