var S=Object.defineProperty;var I=(f,s,i)=>s in f?S(f,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[s]=i;var h=(f,s,i)=>(I(f,typeof s!="symbol"?s+"":s,i),i);import{j as O}from"./AboutHeader-CpM0iYLI.js";import{r as q}from"./index-B80Lgev0.js";import{m as x}from"./main-Br9xqDfn.js";import{B as V}from"./Results-CRgPU-zH.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class k extends V{constructor(){super(...arguments);h(this,"path","items");h(this,"verifyStock",async i=>{try{const{status:u,result:y}=await x.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(i)});if(!u)throw new Error((y==null?void 0:y.message)??"Ocurrió un error al consultar el stock de los productos");return y.data??[]}catch{return[]}});h(this,"getDestacados",async()=>{try{const{status:i,result:u}=await x.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!i)throw new Error((u==null?void 0:u.message)??"Ocurrió un error al consultar el stock de los productos");return u.data??[]}catch{return[]}})}}const v=q.createContext(),P=new k,F=({children:f})=>{const[s,i]=q.useState(()=>{const a=localStorage.getItem("carrito");return a?JSON.parse(a):[]});console.log("data",s);const u=async()=>{try{if(s.length===0)return;P.verifyStock(s.map(a=>a.id)).then(a=>{const r=s.map(c=>{const t=a.find(n=>n.id===c.id);return t?{...c,price:t.price,final_price:t.final_price,discount:t.discount,name:t.name}:c});i(r)})}catch(a){console.error("Error al actualizar precios:",a)}};q.useEffect(()=>{u(),console.log("estoy actualizando")},[]),q.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(s))},[s]);const y=a=>{i(r=>{var e;if(!(a.sizes&&a.sizes.length>0||a.colors&&a.colors.length>0))return r.find(o=>o.id===a.id)?r.map(o=>o.id===a.id?{...o,quantity:o.quantity+a.quantity}:o):[...r,{...a,variations:[],quantity:a.quantity}];const t={color:a.selectedColor||null,size:a.selectedSize||null,quantity:a.quantity},n=r.findIndex(l=>l.id===a.id);if(n>=0){const l=[...r],o=l[n],g=((e=o.variations)==null?void 0:e.findIndex(d=>d.color===t.color&&d.size===t.size))??-1;return g>=0?l[n]={...o,variations:o.variations.map((d,E)=>E===g?{...d,quantity:d.quantity+t.quantity}:d)}:l[n]={...o,variations:[...o.variations,t]},l}else return[...r,{...a,variations:[t],quantity:a.quantity}]})},z=a=>{i(r=>r.filter(c=>c.id!==a))},C=()=>{i([])},w=(a,r=null)=>{i(c=>c.map(t=>t.id===a&&(!t.variations||t.variations.length===0)?{...t,quantity:t.quantity+1}:t.id===a&&t.variations&&t.variations.length>0?r?{...t,variations:t.variations.map(n=>n.color===r.color&&n.size===r.size?{...n,quantity:n.quantity+1}:n)}:{...t,variations:t.variations.map((n,e)=>e===0?{...n,quantity:n.quantity+1}:n)}:t))},m=(a,r=null)=>{i(c=>c.map(t=>{if(t.id===a&&(!t.variations||t.variations.length===0))return{...t,quantity:Math.max(1,t.quantity-1)};if(t.id===a&&t.variations&&t.variations.length>0){if(!r){const e=t.variations.map((l,o)=>o===0?{...l,quantity:Math.max(1,l.quantity-1)}:l);return{...t,variations:e}}const n=t.variations.map(e=>e.color===r.color&&e.size===r.size?{...e,quantity:Math.max(1,e.quantity-1)}:e);return{...t,variations:n}}return t}))},p=(a,r=null)=>{i(c=>r?c.map(t=>{if(t.id===a&&t.variations){const n=t.variations.filter(e=>!(e.color===r.color&&e.size===r.size&&e.quantity===0));return n.length===0?null:{...t,variations:n}}return t}).filter(Boolean):c.filter(t=>!(t.id===a&&t.quantity===0)))};return O.jsx(v.Provider,{value:{carrito:s,agregarAlCarrito:y,eliminarProducto:z,vaciarCarrito:C,actualizarPrecios:u,decrementarCantidad:m,incrementarCantidad:w,eliminarSiCero:p},children:f})};export{F as C,v as a};
