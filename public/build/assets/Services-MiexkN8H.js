var z=Object.defineProperty;var J=(a,t,c)=>t in a?z(a,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[t]=c;var N=(a,t,c)=>(J(a,typeof t!="symbol"?t+"":t,c),c);import{j as s}from"./FileViewer-CpM0iYLI.js";import{r as n}from"./index-B80Lgev0.js";import{B as L}from"./Base-AQptaJc0.js";import{c as W}from"./ReactAppend-CBRQCQGz.js";import{r as F}from"./DxBox-CdMuSyGE.js";import{S as P}from"./sweetalert2.all-Dh0rZL5X.js";import{B as H}from"./Results-B9dLaNz0.js";import{M as K}from"./Modal-CbHkO7Dn.js";import{T as Q}from"./Table-CEq6jy84.js";import{I as T}from"./ImageFormGroup-D0l3yP43.js";import{I as U}from"./InputFormGroup-DZ3W53Mr.js";import{D as E}from"./DxButton-CsjWvhyj.js";import{C as X}from"./CreateReactScript-Bj11ghWz.js";import{R as x}from"./ReactAppend-C-tNgxIf.js";import{S as I}from"./SwitchFormGroup-ChGOZLEW.js";import{L as Y}from"./Filter-1mRNSgu6.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BvL_iu_4.js";/* empty css               */class Z extends H{constructor(){super(...arguments);N(this,"path","admin/services");N(this,"hasFiles",!0)}}const g=new Z,ee=({brands:a})=>{var k;const[t,c]=n.useState([]),m=n.useRef(),v=n.useRef(),b=n.useRef(),j=n.useRef(),C=n.useRef(),h=n.useRef(),f=n.useRef(),l=n.useRef(),[R,y]=n.useState([]),[p,d]=n.useState([{value:""}]),[w,B]=n.useState(!1),D=()=>{d([...p,{value:""}])},G=(e,r)=>{const i=[...p];i[e].value=r,d(i)},_=e=>{if(p.length<=1)return;const r=p.filter((i,u)=>u!==e);d(r)},S=e=>{c(e||null),B(!!(e!=null&&e.id)),b.current.value=(e==null?void 0:e.id)||"",j.current.value=(e==null?void 0:e.title)||"",C.current.value=(e==null?void 0:e.description)||"",h.current.value=null,f.current.value=null;const r=(e==null?void 0:e.color)&&e.color!=="transparent"&&e.color!=="";if(c({...e,transparent_color:!r,color:r?e==null?void 0:e.color:"transparent"}),r?l.current.value=e==null?void 0:e.color:(l.current.value="#000000",l.current.dataset.prevColor="#000000"),e!=null&&e.image&&(h.image.src=`/api/service/media/${e.image}`),e!=null&&e.icon&&(f.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const i=e.gallery.map(u=>({url:`/api/service/media/${u}`,isNew:!1}));y(i)}else y([]);e!=null&&e.characteristics&&e.characteristics.length>0?d(e.characteristics.map(i=>({value:i}))):d([{value:""}]),$(v.current).modal("show")},A=async e=>{e.preventDefault();const r=new FormData;r.append("title",j.current.value),r.append("description",C.current.value),r.append("color",t!=null&&t.transparent_color?"transparent":l.current.value),w&&r.append("id",b.current.value),h.current.files[0]&&r.append("image",h.current.files[0]),f.current.files[0]&&r.append("icon",f.current.files[0]),R.filter(o=>o.isNew).forEach((o,q)=>{r.append(`gallery[${q}]`,o.file)});const i=R.filter(o=>!o.isNew).map(o=>o.url.split("/").pop());r.append("existing_gallery",JSON.stringify(i));const u=p.map(o=>o.value.trim()).filter(o=>o.length>0);r.append("characteristics",JSON.stringify(u)),await g.save(r)&&($(m.current).dxDataGrid("instance").refresh(),$(v.current).modal("hide"),y([]),d([{value:""}]),l.current.value="#000000",f.current.value=null)},M=async e=>{const{isConfirmed:r}=await P.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await g.delete(e)||$(m.current).dxDataGrid("instance").refresh()},O=async({id:e,value:r})=>{await g.boolean({id:e,field:"visible",value:r})&&$(m.current).dxDataGrid("instance").refresh()},V=async({id:e,value:r})=>{await g.boolean({id:e,field:"featured",value:r})&&$(m.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(Q,{gridRef:m,title:"Servicios",rest:g,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(m.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>S()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(F(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:r.description})))}},{dataField:"characteristics",caption:"Características",cellTemplate:(e,{data:r})=>{r.characteristics&&e.html(F(s.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[r.characteristics.slice(0,2).map((i,u)=>s.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:s.jsxs("small",{children:["• ",i]})},u)),r.characteristics.length>2&&s.jsx("li",{children:s.jsxs("small",{className:"text-muted",children:["+",r.characteristics.length-2," ","más..."]})})]})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:r})=>{x(e,s.jsx("img",{src:`/api/service/media/${r.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:i=>i.target.src="/images/default-thumbnail.jpg"}))}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:r})=>{r.icon?x(e,s.jsx("img",{src:`/api/service/media/${r.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:i=>i.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"color",caption:"Color",width:"80px",cellTemplate:(e,{data:r})=>{const i=!r.color||r.color==="transparent"||r.color==="";x(e,s.jsxs("div",{className:"d-flex align-items-center",children:[i?s.jsx("div",{style:{width:"30px",height:"20px",borderRadius:"3px",border:"1px solid #ddd",marginRight:"5px",backgroundImage:"linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 50%, #f0f0f0 50%, #f0f0f0 75%, transparent 75%, transparent)",backgroundSize:"8px 8px"}}):s.jsx("div",{style:{width:"30px",height:"20px",backgroundColor:r.color,borderRadius:"3px",border:"1px solid #ddd",marginRight:"5px"}}),s.jsx("small",{children:i?"Transparente":r.color})]}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",cellTemplate:(e,{data:r})=>{$(e).empty(),x(e,s.jsx(I,{checked:r.featured==1,onChange:()=>V({id:r.id,value:!r.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:r})=>{$(e).empty(),x(e,s.jsx(I,{checked:r.visible==1,onChange:()=>O({id:r.id,value:!r.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.append(E({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>S(r)})),e.append(E({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>M(r.id)}))}}]}),s.jsxs(K,{modalRef:v,title:w?"Editar Servicio":"Nuevo Servicio",onSubmit:A,size:"xl",children:[s.jsx("input",{ref:b,type:"hidden"}),s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-8",children:[s.jsx(U,{eRef:j,label:"Título del servicio",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{ref:C,className:"form-control",rows:4,required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Color del servicio"}),s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("input",{ref:l,type:"color",className:"form-control form-control-color me-2",defaultValue:"#000000",title:"Selecciona un color",disabled:t==null?void 0:t.transparent_color,onChange:e=>{c({...t,color:e.target.value})}}),s.jsxs("div",{className:"form-check",children:[s.jsx("input",{className:"form-check-input",type:"checkbox",id:"transparentColorCheck",checked:t==null?void 0:t.transparent_color,onChange:e=>{const r=l.current.value;if(e.target.checked)l.current.dataset.prevColor=r,l.current.value="",c({...t,transparent_color:!0,color:"transparent"});else{const i=l.current.dataset.prevColor||"#000000";l.current.value=i,c({...t,transparent_color:!1,color:i})}}}),s.jsx("label",{className:"form-check-label",htmlFor:"transparentColorCheck",children:"Sin color (transparente)"})]})]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),p.map((e,r)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Duración de la sesión - 45 a 60 minutos",value:e.value,onChange:i=>G(r,i.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>_(r),disabled:p.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},r)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:D,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),s.jsxs("div",{className:"col-md-4",children:[s.jsx(T,{eRef:h,label:"Imagen principal",aspect:16/9,overlayColor:t!=null&&t.transparent_color?null:(k=l==null?void 0:l.current)==null?void 0:k.value,showColorOverlay:!0}),s.jsx(T,{eRef:f,label:"Icono del servicio",aspect:1/1})]})]})]})]})};X((a,t)=>{W(a).render(s.jsx(Y,{children:s.jsx(L,{...t,title:"Servicios",children:s.jsx(ee,{...t})})}))});
